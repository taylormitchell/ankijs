<script>
  window.cardState = window.cardState || {};
  function get(key, initial) {
    window.cardState[key] = window.cardState[key] || initial;
    return window.cardState[key];
  }
  function set(key, value) {
    window.cardState[key] = value;
    return window.cardState[key];
  }
  // random([lower=0], [upper=1], [floating])
  const random = (...args) => {
    let lower;
    let upper;
    let floating;
    if (typeof args[0] === "boolean") {
      lower = 0;
      upper = 1;
      floating = args[0];
    } else if (typeof args[1] === "boolean") {
      lower = args[0];
      upper = 1;
      floating = args[1];
    } else {
      lower = args[0] || 0;
      upper = args[1] || 1;
      floating = args[2] || false;
    }
    if (floating) {
      return Math.random() * (upper - lower) + lower;
    } else {
      return Math.floor(Math.random() * (upper - lower + 1)) + lower;
    }
  };
  const times = (count, fn) => {
    const result = [];
    for (let i = 0; i < count; i++) {
      result.push(fn(i));
    }
    return result;
  };
  function evalUserscript(side) {
    if (side !== "front" && side !== "back") {
      throw new Error(`Invalid side "${side}"`);
    }
    let html, code, content;
    try {
      // Get and evaluate user script
      html = document.querySelector(`.${side}.userscript`).innerHTML.trim();
      code = new DOMParser().parseFromString(html.replace(/<br>/g, "\n"), "text/html")
        .documentElement.textContent;
      content = eval(code);
    } catch (error) {
      if (error instanceof SyntaxError) {
        // If the userscript is invalid javascript, we assume it's just text
        // and add it to the DOM as is
        content = code;
      } else {
        // Otherwise, we display the error
        content = `Error evaluating ${side}: ${error.message + error.stack}`;
      }
    }
    // If the script returned content, add it to the DOM
    const el = document.querySelector(`.${side}.side`);
    if (!el || !content) {
      return;
    } else if (content instanceof Node) {
      el.appendChild(content);
    } else if (typeof content === "string") {
      el.innerHTML = content;
    }
  }
</script>
<div class="front userscript">{{Front}}</div>
<div class="back userscript">{{Back}}</div>
<div class="front side"></div>
<script>
  evalUserscript("front");
</script>
