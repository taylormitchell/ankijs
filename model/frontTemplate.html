<script>
  window.cardState = window.cardState || {};
  function useCardState(key, initialValue) {
    if (!window.cardState[key]) {
      window.cardState[key] = initialValue;
    }
    return [window.cardState[key], (newValue) => (window.cardState[key] = newValue)];
  }
  function evalUserscript(side) {
    if (side !== "front" && side !== "back") {
      throw new Error(`Invalid side "${side}"`);
    }
    // Get script
    const html = document
      .querySelector(`.${side}.userscript`)
      .innerText.replace(/<br>/g, "\n")
      .trim();
    const code = new DOMParser()
      .parseFromString(html, "text/html")
      .documentElement.textContent.replace(/\/\/.*$/gm, ""); // remove comments
    // Evaluate
    let content;
    try {
      content = eval(code);
    } catch (error) {
      if (error instanceof SyntaxError) {
        // If the userscript is invalid javascript, we assume it's just text
        // and add it to the DOM as is
        content = code;
      } else {
        // Otherwise, we display the error
        content = `Error evaluating ${side}: ${error.message + error.stack}`;
      }
    }
    // If the script returned content, add it to the DOM
    const el = document.querySelector(`.${side}.side`);
    if (!el || !content) {
      return;
    } else if (content instanceof Node) {
      el.appendChild(content);
    } else if (typeof content === "string") {
      el.innerHTML = content;
    }
  }
</script>
<div class="front userscript">{{Front}}</div>
<div class="back userscript">{{Back}}</div>
<div class="front side"></div>
<script>
  evalUserscript("front");
</script>
